/*++----------------------------------------------------------------------------------------------------------------------------------------------------------------------
1. 项目名称：悟空找房h5
2. 文件名：src -> application -> controllers -> xf -> baseinfo -> renderer.js
3. 作者：tangxuyang@lifang.com
4. 备注：新房基本信息页面渲染器
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/

/*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
加载配置及工具
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/
import AppRendererControllerBasic from "../../renderer" ;
import ApiDataFilter from "../../../../system/libraries/apiDataFilter" ;
/*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
创建一个渲染器实例
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/
class Renderer extends AppRendererControllerBasic {
    constructor(req, res, next) {
        super(req, res, next) ;
        this.renders() ;
    }
    /*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    渲染页面
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/
    async renders() {
        let modulePathArray = [ "xf" , "baseinfo" ] ;   
        try {
            let houseId = this.req.params.houseId || "b5c3cf77006f3297" ;   //加密的houseId，b5c3cf77006f3297调试用
            let  channel =this.req.query['channel'] || "";            
            /*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            租房标题和城市名称存起来，后面用
            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/
            let houseTitle = "houseTitle";// apiData.data.houseTitle ;
            let subEstateName = "subEstateName"; //apiData.data.subEstateName ;
            let cityName = "cityName"; //apiData.data.cityName ;
            if(cityName && cityName.charAt(cityName.length - 1) === "市") {
                cityName = cityName.substring( 0 , cityName.length - 1) ;
            }
            /*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            扩展模板常规数据
            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/            
            Object.assign(this.templateData, { 
                "title" : houseTitle + "_" + cityName + subEstateName + "租房-悟空找房" , 
                "keywords" : houseTitle + "，" + subEstateName + "租房，真实房屋出租" ,
                "description" : "悟空找房网为您提供" + subEstateName + "租房信息，整租合租" + cityName + subEstateName + "的房屋就上悟空找房网站，百分百真实房源。" ,
                "wechatTitle" : "",// apiData.data.weChatShare.title ,
                "wechatContent" : "",//apiData.data.weChatShare.content ,
                "wechatImgUrl" : "",// apiData.data.weChatShare.picUrl ,                
                "matchStylesheetPath" : modulePathArray.join("/") ,
                "controllerJavascriptPath" : modulePathArray.join("/") ,
                "cityName" : cityName,  //download-app里面有这样一个变量
                item:{
                    initName: "小区门口"
                }
            }) ;                                                
            
            /*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            渲染模板
            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/              
            this.render(modulePathArray.join("/")) ; 
        }
        catch(ex) {
            this.next(ex) ;
        }
    }
}
/*++-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
最后将render暴露出去
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------++*/
export default Renderer ;